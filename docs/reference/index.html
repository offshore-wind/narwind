<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Function reference • narwind</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Function reference"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-index">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">narwind</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/narwind.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/narw_density.html">NARW density in Canada</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Reference</h1>
    </div>

    <table class="ref-index"><colgroup><col class="alias"><col class="title"></colgroup><tbody><tr><th colspan="2">
          <h2 id="all-functions">All functions <a href="#all-functions" class="anchor" aria-hidden="true"></a></h2>
          <p class="section-desc"></p>
        </th>
      </tr></tbody><tbody><tr><td>
          <p><code><a href="Econtent_cop.html">Econtent_cop</a></code> </p>
        </td>
        <td><p>Energy content of the prey</p></td>
      </tr><tr><td>
          <p><code><a href="RMR.html">RMR</a></code> </p>
        </td>
        <td><p>Resting metabolic rate</p></td>
      </tr><tr><td>
          <p><code><a href="age2length.html">age2length</a></code> </p>
        </td>
        <td><p>Age to length conversion</p></td>
      </tr><tr><td>
          <p><code><a href="clip_density.html">clip_density()</a></code> </p>
        </td>
        <td><p>Title</p></td>
      </tr><tr><td>
          <p><code><a href="density_narw.html">density_narw</a></code> </p>
        </td>
        <td><p>North Atlantic right whale density</p></td>
      </tr><tr><td>
          <p><code><a href="entanglement_event.html">entanglement_event</a></code> </p>
        </td>
        <td><p>Entanglement event</p></td>
      </tr><tr><td>
          <p><code><a href="feeding_threshold.html">feeding_threshold</a></code> </p>
        </td>
        <td><p>Incidence of foraging behavior</p></td>
      </tr><tr><td>
          <p><code><a href="fetal_blubber_mass.html">fetal_blubber_mass</a></code> </p>
        </td>
        <td><p>Fetal blubber mass</p></td>
      </tr><tr><td>
          <p><code><a href="fetal_length.html">fetal_length</a></code> </p>
        </td>
        <td><p>Fetal length</p></td>
      </tr><tr><td>
          <p><code><a href="fetal_mass.html">fetal_mass</a></code> </p>
        </td>
        <td><p>Fetal mass</p></td>
      </tr><tr><td>
          <p><code><a href="fetal_tissue_mass.html">fetal_tissue_mass</a></code> </p>
        </td>
        <td><p>Fetal tissue mass</p></td>
      </tr><tr><td>
          <p><code><a href="fill_mask.html">fill_mask()</a></code> </p>
        </td>
        <td><p>Clip and fill input raster</p></td>
      </tr><tr><td>
          <p><code><a href="filtration_rate.html">filtration_rate</a></code> </p>
        </td>
        <td><p>Filtration rate</p></td>
      </tr><tr><td>
          <p><code><a href="gape_size.html">gape_size</a></code> </p>
        </td>
        <td><p>Area of the gape</p></td>
      </tr><tr><td>
          <p><code><a href="get_ais.html">get_ais()</a></code> </p>
        </td>
        <td><p>Download density maps</p></td>
      </tr><tr><td>
          <p><code><a href="get_density.html">get_density()</a></code> </p>
        </td>
        <td><p>Download density maps</p></td>
      </tr><tr><td>
          <p><code><a href="get_farms.html">get_farms()</a></code> </p>
        </td>
        <td><p>Load wind farm shapefiles</p></td>
      </tr><tr><td>
          <p><code><a href="growth_cost.html">growth_cost</a></code> </p>
        </td>
        <td><p>Energetic cost of growth</p></td>
      </tr><tr><td>
          <p><code><a href="heat_gestation.html">heat_gestation</a></code> </p>
        </td>
        <td><p>Heat increment of gestation</p></td>
      </tr><tr><td>
          <p><code><a href="locomotor_costs.html">locomotor_costs</a></code> </p>
        </td>
        <td><p>Costs of locomotion</p></td>
      </tr><tr><td>
          <p><code><a href="mammary_mass.html">mammary_mass</a></code> </p>
        </td>
        <td><p>Total mass of mammary glands</p></td>
      </tr><tr><td>
          <p><code><a href="milk_assimilation.html">milk_assimilation</a></code> </p>
        </td>
        <td><p>Milk assimilation efficiency</p></td>
      </tr><tr><td>
          <p><code><a href="milk_ingestion.html">milk_ingestion</a></code> </p>
        </td>
        <td><p>Milk ingestion rate</p></td>
      </tr><tr><td>
          <p><code><a href="milk_production.html">milk_production</a></code> </p>
        </td>
        <td><p>Milk production rate</p></td>
      </tr><tr><td>
          <p><code><a href="milk_supply.html">milk_supply</a></code> </p>
        </td>
        <td><p>Milk provisioning</p></td>
      </tr><tr><td>
          <p><code><a href="narw.html">narw()</a></code> </p>
        </td>
        <td><p>Run the bioenergetic model</p></td>
      </tr><tr><td>
          <p><code><a href="narw_crs.html">narw_crs()</a></code> </p>
        </td>
        <td><p>Projected coordinate system</p></td>
      </tr><tr><td>
          <p><code><a href="narwind-package.html">narwind-package</a></code> <code><a href="narwind-package.html">narwind</a></code> </p>
        </td>
        <td><p>A short title line describing what the package does</p></td>
      </tr><tr><td>
          <p><code><a href="narwind.html">narwind</a></code> </p>
        </td>
        <td><p>Population consequences of offshore wind</p></td>
      </tr><tr><td>
          <p><code><a href="new_calf.html">new_calf()</a></code> </p>
        </td>
        <td><p>---------------------------</p></td>
      </tr><tr><td>
          <p><code><a href="placental_maintenance.html">placental_maintenance</a></code> </p>
        </td>
        <td><p>Energetic cost of placental maintenance during pregnancy</p></td>
      </tr><tr><td>
          <p><code><a href="plot.narwproj.html">plot(<i>&lt;narwproj&gt;</i>)</a></code> </p>
        </td>
        <td><p>Plot</p></td>
      </tr><tr><td>
          <p><code><a href="plot.narwsim.html">plot(<i>&lt;narwsim&gt;</i>)</a></code> </p>
        </td>
        <td><p>Plot</p></td>
      </tr><tr><td>
          <p><code><a href="plot_gam.html">plot_gam()</a></code> </p>
        </td>
        <td><p>Decrease in milk feeding efficiency as a function of calf age</p></td>
      </tr><tr><td>
          <p><code><a href="predict.narwsim.html">predict(<i>&lt;narwsim&gt;</i>)</a></code> </p>
        </td>
        <td><p>Forecast NARW abundance</p></td>
      </tr><tr><td>
          <p><code><a href="predict_backup.html">predict_backup()</a></code> </p>
        </td>
        <td><p>------------------------------------------------------
------------------------------------------------------
------------------------------------------------------
------------------------------------------------------
---------------------------
---------------------------
------------------------------------------------------
------------------------------------------------------
------------------------------------------------------
------------------------------------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------</p></td>
      </tr><tr><td>
          <p><code><a href="predict_leslie.html">predict_leslie()</a></code> </p>
        </td>
        <td><p>predictnarwsim &lt;- function(obj,
                            yrs = 35,
                            n = 100) 
  
  # if(is.null(obj$gam)) stop("Insufficient data available. Cannot proceed with population projections.")
  # if(!identical(cohortID, 1:6)) stop("Missing cohorts in input &lt;obj&gt;. Cannot proceed with population projections.")
  # if(length(obj$gam$fit$surv$xlevels[[1]]) &lt; 6 | length(obj$gam$fit$bc$xlevels[[1]]) &lt; 6) stop("Missing factor levels in input &lt;obj&gt;. Cannot proceed with population projections.")
  
  # plogis("link" predictions + error)
  
  # Adapted from original code by Scott Creel
  # https://www.montana.edu/screel/teaching/bioe-440r-521/course-outline/stoch_projection_new.R
  # 
  # Prediction intervals
  # https://stat.ethz.ch/pipermail/r-help/2011-April/275632.html
  
  # Population estimate as per 2022 NARW report card is 340 (+/- 7).
  
  # test &lt;- mgcv::predict.gam(mod$gam[[1]]$surv, newdata = data.frame(start_bc = seq(0,0.6, 0.01)), type = "link", se.fit = TRUE)
  # plot(seq(0,0.6, 0.01), plogis(test$fit), type = "l")
  # lines(seq(0,0.6, 0.01), plogis(Reduce("+", test)), lty = 2)
  # lines(seq(0,0.6, 0.01), plogis(Reduce("-", test)), lty = 2)
  # test2 &lt;- mgcv::predict.gam(mod$gam[[1]]$surv, newdata = data.frame(start_bc = 0.2), type = "response")
  # abline(v = 0.2)
  # abline(h = tesct2)
  
  cohortID &lt;- obj$param$cohortID
  cohorts &lt;- obj$param$cohorts |&gt; dplyr::slice(1) |&gt; 
    dplyr::mutate(name = gsub(", female", "", name), abb = gsub(",f", "", abb)) |&gt; 
    dplyr::bind_rows(obj$param$cohorts) |&gt; 
    dplyr::mutate(name = gsub("male, female", "female", name), abb = gsub("m,f", "f", abb))
  cohorts &lt;- cohorts[c(1,3,5,2,4,6,7,8)]
  
  # Attributes to monitor during projection
  mat.attribs &lt;- c("alive", "cohort", "female", "age", "length", "length_a", "length_b", "length_c",
                   "tot_mass", "lean_mass", "bc", "mass_a", "mass_b", "p_surv", "min_bc", "calving_int", "t2calf", "birth")
  
  # Current year
  current.yr &lt;- lubridate::year(lubridate::now())
  
  # Extract terminal functions
  mod &lt;- obj$gam$fit
  mod[["gest"]] &lt;- gam_gest
  
  #'------------------------------------------------------
  # INITIALIZATION
  #'------------------------------------------------------
  
  # Define initial population vector
  N0 &lt;- c(2, 5, 212, 2, 69, 1, 7, 61)
  names(N0) &lt;- cohorts[, name]
  
  # Create matrices and initialize them
  # rows: years &lt;yrs&gt;
  # columns: &lt;attributes&gt;
  # layers: individuals &lt;n&gt;
  # 4th dimension: replicate projection -&gt; later converted to list
  narw.indiv &lt;- array(data = NA, c(yrs + 1, length(mat.attribs), sum(N0), n), 
                      dimnames = list(paste0("yr ", 0:yrs), 
                                      mat.attribs,
                                      paste0("whale ", 1:sum(N0)),
                                      paste0("prj ", 1:n)))
  
  cohort.vec &lt;- do.call(c, sapply(X = 1:nrow(cohorts), FUN = function(x) rep(cohorts$id[x], each = N0[x])))
  
  # Alive and population cohort
  narw.indiv[1,"alive",,] &lt;- 1
  narw.indiv[1,"cohort",,] &lt;- rep(cohort.vec, n)
  
  # Sex
  #  -- Calves (male)
  narw.indiv[,"female", 1:N0[1], ] &lt;- 0  
  #  -- Calves (female)
  fem &lt;- which(cohort.vec == 0)
  narw.indiv[,"female", fem[fem &gt; N0[1]], ] &lt;- 1   
  #  -- Juveniles and adults
  narw.indiv[,"female", which(cohort.vec <!-- %in% c(2,4,5,6)), ] &lt;- 1 -->
  narw.indiv[,"female", which(cohort.vec <!-- %in% c(1,3)), ] &lt;- 0 -->
  
  # Age
  ages &lt;- start_age_vec(rep(cohort.vec, n))
  narw.indiv[1,"age", , ] &lt;- ages
  
  # Total body length
  l.params &lt;- agL_vec(ages)
  lengths &lt;- age2length_vec(ages, l.params)
  narw.indiv[1,"length", , ] &lt;- lengths
  narw.indiv[,"length_a",,] &lt;- rep(l.params[,1], each = yrs + 1)
  narw.indiv[,"length_b",,] &lt;- rep(l.params[,2], each = yrs + 1)
  narw.indiv[,"length_c",,] &lt;- rep(l.params[,3], each = yrs + 1)
  
  # Total mass
  m.params &lt;- mL(n*sum(N0))
  mass &lt;- length2mass_vec(lengths, m.params, FALSE)
  narw.indiv[,"mass_a",,] &lt;- rep(m.params[,1], each = yrs + 1)
  narw.indiv[,"mass_b",,] &lt;- rep(m.params[,2], each = yrs + 1)
  narw.indiv[1,"tot_mass", , ] &lt;- mass
  
  # Body conditon
  narw.indiv[1,"bc",,] &lt;- start_bcondition_vec(rep(cohort.vec, n))
  
  # lean mass
  narw.indiv[1,"lean_mass", , ] &lt;- mass - (narw.indiv[1,"bc",,] * mass)
  
  # Calving interval - mean of 5.3 years, up to apparent gaps of 13 years (Kraus et al. 2001)
  # NARWC Report Card 2022: Average inter-birth interval of 7.7 yrs, median of 8, min/max (2/13)
  # This corresponds to a Normal (7.7, 1.45)
  # Mean age at first calving = 9.53 +/- 2.32 (Kraus et al. 2001)
  # 
  # Stewart et al. 2022 -- 
  # The degree to which the energetic reserves of females are depleted during lactation may govern
  # the length of the resting period between successful pregnancies (Miller et al. 2011, Marón et al. 2015).
  narw.indiv[1,"calving_int",,] &lt;- (rep(cohort.vec, n) == 6) * rnorm(sum(N0)*n, mean = 7.7, sd = 1.45)
  narw.indiv[1,"t2calf",,] &lt;- round(narw.indiv[1,"calving_int",,],0)
  
  narw.indiv[1,"min_bc",,] &lt;- predict_m(model = mod,
                                        values = as.vector(narw.indiv[1,"tot_mass",,]), 
                                        prediction = "gest") * as.vector(narw.indiv[1, "cohort",, ] == 6)
  narw.indiv[1,"birth",,] &lt;- 0
  narw.indiv[1,"p_surv",,] &lt;- 1
  
  #' ---------------------------
  # IMPORTANT 
  #' ---------------------------
  # Turn array into a list - otherwise cannot add new calves within projections
  narw.indiv &lt;- purrr::array_branch(narw.indiv, 4) 
  
  # Number of individuals in each cohort
  narw.pop &lt;- array(data = NA, c(n, yrs + 1, length(N0)), 
                    dimnames = list(paste0("prj ", 1:n),
                                    paste0("yr ", 0:yrs), 
                                    cohorts$name))
  narw.pop[,1,] &lt;- rep(N0, each = n)
  
  # Total population size
  tot.pop &lt;- matrix(0, n, yrs + 1, dimnames = list(paste0("prj",1:n), paste0("yr ", 0:yrs)))
  tot.pop[,1] &lt;- sum(N0)
  
  #'------------------------------------------------------
  # RUN PROJECTIONS
  #'------------------------------------------------------
  
  # This uses nested loops. 
  # The prj loop (outermost loop) replicates the projection &lt;n&gt; times.
  # The i loop is next, and steps across all years of projection from an initial population vector.
  
  # Set up progress bar
  pb &lt;- progress::progress_bar$new(
    format = "[:bar] :percent eta: :eta",
    total = n, clear = FALSE, width = 80
  )
  
  for(prj in 1:n)
    
    pb$tick() # Update progress bar
    
    #'------------------------------------------------------
    # Loop over years
    #'------------------------------------------------------
    
    for(i in 2:(yrs+1))
      
      current.dat &lt;- as.matrix(narw.indiv[[prj]][i-1, , ])
      alive &lt;- narw.indiv[[prj]][i-1, "alive", ]
      
      #' ----------------------------
      # SURVIVAL
      #' ----------------------------
      # Predict survival probability based on body condition
      ps &lt;- alive * predict_m(model = mod, cohort = current.dat["cohort",], values = current.dat["bc",], prediction = "surv")
      narw.indiv[[prj]][i, "p_surv", ] &lt;- ps
      
      # Determine whether the animal survived
      # Maximum longevity of 69 years
      alive &lt;- rbinom(n = dim(narw.indiv[[prj]])[3], size = 1, prob = ps) * (narw.indiv[[prj]][i-1, "age", ] &lt;=69)
      narw.indiv[[prj]][i, "alive", ] &lt;- alive
      
      # Sex remains the same
      narw.indiv[[prj]][i, "female", ] &lt;- narw.indiv[[prj]][i-1, "female", ]
      
      #' ----------------------------
      # GROWTH
      #' ----------------------------
      
      # Increment age
      narw.indiv[[prj]][i, "age", ] &lt;- alive * narw.indiv[[prj]][i-1, "age", ] + 1
      
      # Increment length
      narw.indiv[[prj]][i,"length", ] &lt;- alive * age2length_vec(narw.indiv[[prj]][i, "age", ],
                                                                t(narw.indiv[[prj]][i, c("length_a", "length_b", "length_c"),]))
      
      # Increment lean mass
      narw.indiv[[prj]][i,"lean_mass", ] &lt;- alive * length2mass_vec(narw.indiv[[prj]][i, "length", ],
                                                                    t(narw.indiv[[prj]][i, c("mass_a", "mass_b"),]), lean = TRUE)
      
      # Predict new body condition from current body condition
      narw.indiv[[prj]][i, "bc", ] &lt;- alive * predict_m(model = mod, cohort = current.dat["cohort",],
                                                        values = current.dat["bc",], prediction = "bc")
      
      # Increment total mass
      narw.indiv[[prj]][i,"tot_mass", ] &lt;- alive * narw.indiv[[prj]][i,"lean_mass", ] / (1 - narw.indiv[[prj]][i,"bc", ])
      
      #' ----------------------------
      # REPRODUCTION
      #' ----------------------------
      
      narw.indiv[[prj]][i, "calving_int", ] &lt;- alive * narw.indiv[[prj]][i-1, "calving_int", ]
      narw.indiv[[prj]][i, "t2calf", ] &lt;- ifelse(narw.indiv[[prj]][i-1, "t2calf", ] - 1 &lt; 0, 0, narw.indiv[[prj]][i-1, "t2calf", ] - 1)
      
      # Minimum body condition needed to successfully bring fetus to term without starving
      # No evidence of reproductive senescence in right whales - Hamilton et al. (1998)
      narw.indiv[[prj]][i, "min_bc", ] &lt;- alive * predict_m(model = mod, values = narw.indiv[[prj]][i, "tot_mass", ], 
                                                            prediction = "gest") * (narw.indiv[[prj]][i-1, "cohort", ] == 6)
      
      # Birth of new calf
      narw.indiv[[prj]][i, "birth", ] &lt;- alive * (narw.indiv[[prj]][i, "bc", ] &gt;= narw.indiv[[prj]][i, "min_bc", ]) * 
        (narw.indiv[[prj]][i-1, "cohort", ] == 6) * (narw.indiv[[prj]][i-1, "birth", ] == 0)
      
      # Maturity - transitions between cohorts
      narw.indiv[[prj]][i, "cohort", ] &lt;- alive * increment_cohort(cohort = narw.indiv[[prj]][i-1, "cohort", ],
                                                                   age = narw.indiv[[prj]][i, "age", ],
                                                                   female = narw.indiv[[prj]][i, "female", ],
                                                                   t2calf = narw.indiv[[prj]][i, "t2calf", ])
      
      # New births
      # narw.indiv[[prj]] &lt;- new_calf(narw.indiv[[prj]][,,], year = i, attrib = mat.attribs)
      
      # Number of animals in each cohort
      # Calves (male)
      narw.pop[prj, i, 1] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 0) *
                                   (narw.indiv[[prj]][i, "female", ] == 0) *
                                   (narw.indiv[[prj]][i, "alive", ] == 1))
      
      # Juveniles and adults (male)
      narw.pop[prj, i, 2] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 1) * (narw.indiv[[prj]][i, "alive", ] == 1))
      narw.pop[prj, i, 3] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 3) * (narw.indiv[[prj]][i, "alive", ] == 1))
      
      # Calves (female)
      narw.pop[prj, i, 4] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 0) *
                                   (narw.indiv[[prj]][i, "female", ] == 1) *
                                   (narw.indiv[[prj]][i, "alive", ] == 1))
      
      # Juvenile and reproductive adults (female)
      narw.pop[prj, i, 5] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 2) * (narw.indiv[[prj]][i, "alive", ] == 1))
      narw.pop[prj, i, 6] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 4) * (narw.indiv[[prj]][i, "alive", ] == 1))
      narw.pop[prj, i, 7] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 5) * (narw.indiv[[prj]][i, "alive", ] == 1))
      narw.pop[prj, i, 8] &lt;- sum((narw.indiv[[prj]][i, "cohort", ] == 6) * (narw.indiv[[prj]][i, "alive", ] == 1))
      
      # Total population size
      tot.pop[prj, i] &lt;- sum(narw.indiv[[prj]][i, "alive", ], na.rm = TRUE)
      
     # End years
   # End projections
  
  # Compile outputs
  narw.df &lt;- purrr::map(.x = cohorts$name, .f = ~
    narw.pop[,,.x] |&gt; 
      tibble::as_tibble() |&gt; 
      tibble::rownames_to_column(var = "prj") |&gt; 
      tidyr::pivot_longer(!prj, names_to = "year", values_to = "N") |&gt; 
      dplyr::mutate(year = current.yr + as.numeric(gsub("yr ", "", year))) |&gt; 
      dplyr::mutate(cohort = stringr::str_to_sentence(.x))
  ) |&gt; do.call(what = rbind) |&gt; data.table::data.table()
  
  tot.df &lt;- tibble::as_tibble(tot.pop) |&gt; 
    tibble::rownames_to_column(var = "prj") |&gt; 
    tidyr::pivot_longer(!prj, names_to = "year", values_to = "N") |&gt; 
    dplyr::mutate(year = current.yr + as.numeric(gsub("yr ", "", year))) |&gt; 
    dplyr::mutate(cohort = "North Atlantic right whales") |&gt; data.table::data.table()
  
  narw.conf &lt;- narw.df[, list(mean = mean(N), lwr = quantile(N, 0.025), uppr = quantile(N, 0.975)), list(year, cohort)] |&gt; 
    dplyr::mutate(cohort = factor(cohort, levels = c("Calves (male)",
                                                     "Calves (female)",
                                                     "Juveniles (male)", 
                                                     "Juveniles (female)", 
                                                     "Adults (male)",
                                                     "Adults (female, pregnant)",
                                                     "Adults (female, lactating)",
                                                     "Adults (female, resting)")))
  
  tot.conf &lt;- tot.df[, list(mean = mean(N), lwr = quantile(N, 0.025), uppr = quantile(N, 0.975)), list(year, cohort)]|&gt; 
    dplyr::mutate(cohort = factor(cohort, levels = c("Calves (male)",
                                                     "Calves (female)",
                                                     "Juveniles (male)", 
                                                     "Juveniles (female)", 
                                                     "Adults (male)",
                                                     "Adults (female, pregnant)",
                                                     "Adults (female, lactating)",
                                                     "Adults (female, resting)",
                                                     "North Atlantic right whales")))
  
  p1 &lt;- plot_projection(narw.df, narw.conf)
  p2 &lt;- plot_projection(tot.df, tot.conf)
  
  print(p1)
  print(p2)
  
  # Find 95<!-- % confidence intervals on final population size -->
  cat("Final population size:")
  final.pop &lt;- unname(tot.df[year == current.yr + yrs,  quantile(N, probs = c(0.5, 0.025, 0.975))])
  cat("N = ", final.pop[1], " (95<!-- % CI: ", final.pop[2], "–", final.pop[3], ")\n", sep = "") -->
  
  return(list(ind = narw.indiv, df = rbind(narw.df, tot.df), ci = rbind(narw.conf, tot.conf)))
  

----------------------------</p></td>
      </tr><tr><td>
          <p><code><a href="print.narwsim.html">print(<i>&lt;narwsim&gt;</i>)</a></code> </p>
        </td>
        <td><p>Overview of model results</p></td>
      </tr><tr><td>
          <p><code><a href="rtnorm.html">rtnorm()</a></code> </p>
        </td>
        <td><p>Random deviate from a truncated Normal distribution</p></td>
      </tr><tr><td>
          <p><code><a href="start_age.html">start_age</a></code> </p>
        </td>
        <td><p>Initialize age</p></td>
      </tr><tr><td>
          <p><code><a href="start_bcondition.html">start_bcondition</a></code> </p>
        </td>
        <td><p>Initialize body condition</p></td>
      </tr><tr><td>
          <p><code><a href="start_mouth.html">start_mouth</a></code> </p>
        </td>
        <td><p>Mouth-width-to-length ratio</p></td>
      </tr><tr><td>
          <p><code><a href="summary.narwsim.html">summary(<i>&lt;narwsim&gt;</i>)</a></code> </p>
        </td>
        <td><p>Summary</p></td>
      </tr><tr><td>
          <p><code><a href="w_density.html">w_density()</a></code> </p>
        </td>
        <td><p>#' Initialize model
#'
#' @export
load &lt;- function()
  Rcpp::sourceCpp("src/simtools.cpp")
  # Rcpp::sourceCpp("src/bioenergetics_functions.cpp")
  source("R/run_model.R")
  assign("init.model", value = TRUE, envir = .GlobalEnv)</p></td>
      </tr><tr><td>
          <p><code><a href="write.narwproj.html">write(<i>&lt;narwproj&gt;</i>)</a></code> </p>
        </td>
        <td><p>Summary</p></td>
      </tr><tr><td>
          <p><code><a href="write.narwsim.html">write(<i>&lt;narwsim&gt;</i>)</a></code> </p>
        </td>
        <td><p>Summary</p></td>
      </tr></tbody></table></div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Phil J. Bouchet.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

